{"version":3,"file":"tool_screenshot.js","sourceRoot":"","sources":["../../../../inspector_overlay/tool_screenshot.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2019 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport {Overlay} from './common.js';\n\nexport type ScreenshotToolMessage = {\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n};\n\nlet anchor: {x: number, y: number}|null = null;\nlet position: {x: number, y: number}|null = null;\n\nexport class ScreenshotOverlay extends Overlay {\n  private zone!: HTMLElement;\n\n  constructor(window: Window, style: CSSStyleSheet[] = []) {\n    super(window, style);\n    this.onMouseDown = this.onMouseDown.bind(this);\n    this.onMouseUp = this.onMouseUp.bind(this);\n    this.onMouseMove = this.onMouseMove.bind(this);\n    this.onKeyDown = this.onKeyDown.bind(this);\n  }\n\n  install() {\n    const root = this.document.documentElement;\n    root.addEventListener('mousedown', this.onMouseDown, true);\n    root.addEventListener('mouseup', this.onMouseUp, true);\n    root.addEventListener('mousemove', this.onMouseMove, true);\n    root.addEventListener('keydown', this.onKeyDown, true);\n\n    const zone = this.document.createElement('div');\n    zone.id = 'zone';\n    this.document.body.append(zone);\n\n    this.zone = zone;\n\n    super.install();\n  }\n\n  uninstall() {\n    this.document.body.innerHTML = '';\n    const root = this.document.documentElement;\n    root.removeEventListener('mousedown', this.onMouseDown, true);\n    root.removeEventListener('mouseup', this.onMouseUp, true);\n    root.removeEventListener('mousemove', this.onMouseMove, true);\n    root.removeEventListener('keydown', this.onKeyDown, true);\n    super.uninstall();\n  }\n\n  onMouseDown(event: MouseEvent) {\n    anchor = {x: event.pageX, y: event.pageY};\n    position = anchor;\n    this.updateZone();\n    event.stopPropagation();\n    event.preventDefault();\n  }\n\n  onMouseUp(event: MouseEvent) {\n    if (anchor && position) {\n      const rect = currentRect();\n      if (rect.width >= 5 && rect.height >= 5) {\n        this.window.InspectorOverlayHost.send(rect);\n      }\n    }\n    cancel();\n    this.updateZone();\n    event.stopPropagation();\n    event.preventDefault();\n  }\n\n  onMouseMove(event: MouseEvent) {\n    if (anchor && event.buttons === 1) {\n      position = {x: event.pageX, y: event.pageY};\n    } else {\n      anchor = null;\n    }\n    this.updateZone();\n    event.stopPropagation();\n    event.preventDefault();\n  }\n\n  onKeyDown(event: KeyboardEvent) {\n    if (anchor && event.key === 'Escape') {\n      cancel();\n      this.updateZone();\n      event.stopPropagation();\n      event.preventDefault();\n    }\n  }\n\n  updateZone() {\n    const zone = this.zone;\n    if (!position || !anchor) {\n      zone.style.display = 'none';\n      return;\n    }\n    zone.style.display = 'block';\n    const rect = currentRect();\n    zone.style.left = rect.x + 'px';\n    zone.style.top = rect.y + 'px';\n    zone.style.width = rect.width + 'px';\n    zone.style.height = rect.height + 'px';\n  }\n}\n\nfunction currentRect() {\n  if (!anchor) {\n    throw new Error('Error calculating currentRect: no anchor was defined.');\n  }\n  if (!position) {\n    throw new Error('Error calculating currentRect: no position was defined.');\n  }\n  return {\n    x: Math.min(anchor.x, position.x),\n    y: Math.min(anchor.y, position.y),\n    width: Math.abs(anchor.x - position.x),\n    height: Math.abs(anchor.y - position.y),\n  };\n}\n\nfunction cancel() {\n  anchor = null;\n  position = null;\n}\n"]}