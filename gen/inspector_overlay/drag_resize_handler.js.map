{"version":3,"file":"drag_resize_handler.js","sourceRoot":"","sources":["../../../../inspector_overlay/drag_resize_handler.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2021 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nexport const enum ResizerType {\n  WIDTH = 'width',\n  HEIGHT = 'height',\n  BIDIRECTION = 'bidirection',\n}\n\nexport interface Draggable {\n  type: ResizerType;\n  initialWidth?: number;\n  initialHeight?: number;\n  update({width, height}: {width?: number, height?: number}): void;\n}\n\nexport interface Delegate {\n  getDraggable(x: number, y: number): Draggable|undefined;\n}\n\nconst cursorByResizerType = new Map([\n  [ResizerType.WIDTH, 'ew-resize'],\n  [ResizerType.HEIGHT, 'ns-resize'],\n  [ResizerType.BIDIRECTION, 'nwse-resize'],\n]);\n\ntype OriginInfo = {\n  coord: number,\n  value: number,\n};\n\nexport class DragResizeHandler {\n  private document: Document;\n  private delegate: Delegate;\n  private originX?: OriginInfo;\n  private originY?: OriginInfo;\n  private boundMousemove: (event: MouseEvent) => void;\n  private boundMousedown: (event: MouseEvent) => void;\n\n  constructor(document: Document, delegate: Delegate) {\n    this.document = document;\n    this.delegate = delegate;\n    this.boundMousemove = this.onMousemove.bind(this);\n    this.boundMousedown = this.onMousedown.bind(this);\n  }\n\n  install() {\n    this.document.body.addEventListener('mousemove', this.boundMousemove);\n    this.document.body.addEventListener('mousedown', this.boundMousedown);\n  }\n\n  uninstall() {\n    this.document.body.removeEventListener('mousemove', this.boundMousemove);\n    this.document.body.removeEventListener('mousedown', this.boundMousedown);\n  }\n\n  /**\n   * Updates the cursor style of the mouse is hovered over a resizeable area.\n   */\n  private onMousemove(event: MouseEvent) {\n    const match = this.delegate.getDraggable(event.clientX, event.clientY);\n    if (!match) {\n      this.document.body.style.cursor = 'default';\n      return;\n    }\n    this.document.body.style.cursor = cursorByResizerType.get(match.type) || 'default';\n  }\n\n  /**\n   * Starts dragging\n   */\n  private onMousedown(event: MouseEvent) {\n    const match = this.delegate.getDraggable(event.clientX, event.clientY);\n    if (!match) {\n      return;\n    }\n\n    const boundOnDrag = this.onDrag.bind(this, match);\n\n    event.stopPropagation();\n    event.preventDefault();\n\n    if (match.initialWidth !== undefined &&\n        (match.type === ResizerType.WIDTH || match.type === ResizerType.BIDIRECTION)) {\n      this.originX = {\n        coord: Math.round(event.clientX),\n        value: match.initialWidth,\n      };\n    }\n\n    if (match.initialHeight !== undefined &&\n        (match.type === ResizerType.HEIGHT || match.type === ResizerType.BIDIRECTION)) {\n      this.originY = {\n        coord: Math.round(event.clientY),\n        value: match.initialHeight,\n      };\n    }\n\n    this.document.body.removeEventListener('mousemove', this.boundMousemove);\n    this.document.body.style.cursor = cursorByResizerType.get(match.type) || 'default';\n\n    const endDrag = (event: Event) => {\n      event.stopPropagation();\n      event.preventDefault();\n      this.originX = undefined;\n      this.originY = undefined;\n\n      this.document.body.style.cursor = 'default';\n      this.document.body.removeEventListener('mousemove', boundOnDrag);\n      this.document.body.addEventListener('mousemove', this.boundMousemove);\n    };\n\n    this.document.body.addEventListener('mouseup', endDrag, {once: true});\n    window.addEventListener('mouseout', endDrag, {once: true});\n\n    this.document.body.addEventListener('mousemove', boundOnDrag);\n  }\n\n  /**\n   * Computes the new value while the cursor is being dragged and calls InspectorOverlayHost with the new value.\n   */\n  private onDrag(match: Draggable, e: MouseEvent) {\n    if (!this.originX && !this.originY) {\n      return;\n    }\n\n    let width: number|undefined;\n    let height: number|undefined;\n    if (this.originX) {\n      const delta = this.originX.coord - e.clientX;\n      width = Math.round(this.originX.value - delta);\n    }\n\n    if (this.originY) {\n      const delta = this.originY.coord - e.clientY;\n      height = Math.round(this.originY.value - delta);\n    }\n\n    match.update({width, height});\n  }\n}\n"]}