{"version":3,"file":"snippets_test.js","sourceRoot":"","sources":["../../../../../../test/e2e/snippets/snippets_test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2020 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport {assert} from 'chai';\n\nimport {getBrowserAndPages, timeout, typeText, waitFor} from '../../shared/helper.js';\nimport {describe, it} from '../../shared/mocha-extensions.js';\nimport {getCurrentConsoleMessages} from '../helpers/console-helpers.js';\nimport {getAvailableSnippets, openCommandMenu, showSnippetsAutocompletion} from '../helpers/quick_open-helpers.js';\nimport {addSelectedTextToWatches, createNewSnippet, evaluateSelectedTextInConsole, getWatchExpressionsValues, openSnippetsSubPane, openSourcesPanel, runSnippet} from '../helpers/sources-helpers.js';\n\n// Flaky test\ndescribe.skip('[crbug.com/1198160]: Snippet creation', () => {\n  it('can show newly created snippets show up in command menu', async () => {\n    const {frontend} = getBrowserAndPages();\n\n    await openSourcesPanel();\n    await openSnippetsSubPane();\n    await createNewSnippet('New snippet');\n\n    await openCommandMenu();\n    await showSnippetsAutocompletion();\n\n    assert.deepEqual(await getAvailableSnippets(), [\n      'New snippet\\u200B',\n    ]);\n\n    await typeText('New ');\n    assert.deepEqual(await getAvailableSnippets(), [\n      'New snippet\\u200B',\n    ]);\n\n    await typeText('w');\n    assert.deepEqual(await getAvailableSnippets(), []);\n\n    await frontend.keyboard.press('Backspace');\n    assert.deepEqual(await getAvailableSnippets(), [\n      'New snippet\\u200B',\n    ]);\n  });\n});\n\n// Flaky test (likely further bit-rotted by CM6 transition)\ndescribe.skip('[crbug.com/1198160]: Expression evaluation', () => {\n  const message = '\"Hello\"';\n\n  beforeEach(async () => {\n    const {frontend} = getBrowserAndPages();\n    await openSourcesPanel();\n    await openSnippetsSubPane();\n    await createNewSnippet('New snippet');\n    await typeText(`(x => {debugger})(${message});`);\n    await runSnippet();\n\n    const functionParameterElement = await waitFor('.cm-js-def');\n    const parameterElementPosition = await functionParameterElement.evaluate(elem => {\n      const {x, y, right} = elem.getBoundingClientRect();\n      return {x, y, right};\n    });\n    await frontend.mouse.move(parameterElementPosition.x, parameterElementPosition.y);\n    await frontend.mouse.down();\n    await frontend.mouse.move(parameterElementPosition.right, parameterElementPosition.y);\n    await frontend.mouse.up();\n  });\n\n  afterEach(async () => {\n    const {frontend} = getBrowserAndPages();\n    await frontend.reload();\n  });\n\n  it('evaluates a selected expression in the console', async () => {\n    await evaluateSelectedTextInConsole();\n    // Prevent flakyness by awaiting some time for the text to be evaluated\n    await timeout(200);\n    const messages = await getCurrentConsoleMessages();\n    assert.deepEqual(messages, [\n      message,\n    ]);\n  });\n\n  it('adds an expression to watches', async () => {\n    await addSelectedTextToWatches();\n    const watchExpressions = await getWatchExpressionsValues();\n    assert.deepEqual(watchExpressions, [\n      message,\n    ]);\n  });\n});\n\ndescribe('Snippet evaluation', () => {\n  it('highlights the correct line when a snippet throws an error', async () => {\n    await openSourcesPanel();\n    await openSnippetsSubPane();\n    await createNewSnippet('throwing', `\n      (function foo() {\n        throw new Error('kaboom');\n      })();`);\n\n    await runSnippet();\n\n    const errorLine = await waitFor('.cm-waveUnderline');\n    const text = await errorLine.evaluate(el => el.textContent);\n    assert.strictEqual(text, 'throw new Error(\\'kaboom\\');');\n  });\n});\n"]}