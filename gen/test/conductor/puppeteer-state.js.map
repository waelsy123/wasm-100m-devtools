{"version":3,"file":"puppeteer-state.js","sourceRoot":"","sources":["../../../../../test/conductor/puppeteer-state.ts"],"names":[],"mappings":";AAAA,4DAA4D;AAC5D,yEAAyE;AACzE,6BAA6B;;;AAE7B,uCAAuC;AAEvC,yEAAkG;AAElG,IAAI,MAA2B,CAAC;AAChC,IAAI,QAA6B,CAAC;AAClC,IAAI,OAA+B,CAAC;AAEpC,+DAA+D;AAC/D,+CAA+C;AAC/C,IAAI,cAA2B,CAAC;AAQzB,MAAM,mBAAmB,GAAG,GAAG,EAAE;IACtC,MAAM,GAAG,IAAI,CAAC;IACd,QAAQ,GAAG,IAAI,CAAC;IAChB,OAAO,GAAG,IAAI,CAAC;IACf,cAAc,GAAG,IAAI,CAAC;AACxB,CAAC,CAAC;AALW,QAAA,mBAAmB,uBAK9B;AAEK,MAAM,kBAAkB,GAAG,CAAC,SAA0B,EAAE,EAAE;IAC/D,IAAI,MAAM,IAAI,QAAQ,IAAI,OAAO,EAAE;QACjC,MAAM,IAAI,KAAK,CAAC,yCAAyC,CAAC,CAAC;KAC5D;IAED,CAAC,EAAC,MAAM,EAAE,QAAQ,EAAE,OAAO,EAAC,GAAG,SAAS,CAAC,CAAC;AAC5C,CAAC,CAAC;AANW,QAAA,kBAAkB,sBAM7B;AAEK,MAAM,kBAAkB,GAAG,GAAoB,EAAE;IACtD,IAAI,CAAC,MAAM,EAAE;QACX,MAAM,IAAI,KAAK,CAAC,oDAAoD,CAAC,CAAC;KACvE;IAED,IAAI,CAAC,QAAQ,EAAE;QACb,MAAM,IAAI,KAAK,CAAC,+DAA+D,CAAC,CAAC;KAClF;IAED,IAAI,CAAC,OAAO,EAAE;QACZ,MAAM,IAAI,KAAK,CAAC,yDAAyD,CAAC,CAAC;KAC5E;IAED,OAAO;QACL,MAAM;QACN,QAAQ;QACR,OAAO;KACR,CAAC;AACJ,CAAC,CAAC;AAlBW,QAAA,kBAAkB,sBAkB7B;AAEK,MAAM,iBAAiB,GAAG,CAAC,IAAY,EAAE,EAAE;IAChD,IAAI,cAAc,EAAE;QAClB,MAAM,IAAI,KAAK,CAAC,wCAAwC,CAAC,CAAC;KAC3D;IACD,cAAc,GAAG,IAAI,CAAC;AACxB,CAAC,CAAC;AALW,QAAA,iBAAiB,qBAK5B;AAEK,MAAM,iBAAiB,GAAG,GAAG,EAAE;IACpC,IAAI,CAAC,cAAc,EAAE;QACnB,MAAM,IAAI,KAAK,CACX,yDAAyD;YACzD,gFAAgF;YAChF,wCAAwC,CAAC,CAAC;KAC/C;IACD,OAAO,cAAc,CAAC;AACxB,CAAC,CAAC;AARW,QAAA,iBAAiB,qBAQ5B;AAEF,IAAI,iBAAiB,GAAG,KAAK,CAAC;AACvB,MAAM,gBAAgB,GAAG,GAAG,EAAE;IACnC,IAAI,iBAAiB,EAAE;QACrB,OAAO;KACR;IACD,SAAS,CAAC,0BAA0B,CAAC,kBAAkB,EAAE;QACvD,QAAQ,EAAE,qDAA0B;QACpC,QAAQ,EAAE,qDAA0B;KACrC,CAAC,CAAC;IACH,iBAAiB,GAAG,IAAI,CAAC;AAC3B,CAAC,CAAC;AATW,QAAA,gBAAgB,oBAS3B","sourcesContent":["// Copyright 2020 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as puppeteer from 'puppeteer';\n\nimport {querySelectorShadowTextAll, querySelectorShadowTextOne} from './custom-query-handlers.js';\n\nlet target: puppeteer.Page|null;\nlet frontend: puppeteer.Page|null;\nlet browser: puppeteer.Browser|null;\n\n// Set when we launch the server. It will be different for each\n// sub-process runner when running in parallel.\nlet testServerPort: number|null;\n\nexport interface BrowserAndPages {\n  target: puppeteer.Page;\n  frontend: puppeteer.Page;\n  browser: puppeteer.Browser;\n}\n\nexport const clearPuppeteerState = () => {\n  target = null;\n  frontend = null;\n  browser = null;\n  testServerPort = null;\n};\n\nexport const setBrowserAndPages = (newValues: BrowserAndPages) => {\n  if (target || frontend || browser) {\n    throw new Error('Can\\'t set the puppeteer browser twice.');\n  }\n\n  ({target, frontend, browser} = newValues);\n};\n\nexport const getBrowserAndPages = (): BrowserAndPages => {\n  if (!target) {\n    throw new Error('Unable to locate target page. Was it stored first?');\n  }\n\n  if (!frontend) {\n    throw new Error('Unable to locate DevTools frontend page. Was it stored first?');\n  }\n\n  if (!browser) {\n    throw new Error('Unable to locate browser instance. Was it stored first?');\n  }\n\n  return {\n    target,\n    frontend,\n    browser,\n  };\n};\n\nexport const setTestServerPort = (port: number) => {\n  if (testServerPort) {\n    throw new Error('Can\\'t set the test server port twice.');\n  }\n  testServerPort = port;\n};\n\nexport const getTestServerPort = () => {\n  if (!testServerPort) {\n    throw new Error(\n        'Unable to locate test server port. Was it stored first?' +\n        '\\nYou might be calling this function at module instantiation time, instead of ' +\n        'at runtime when the port is available.');\n  }\n  return testServerPort;\n};\n\nlet handlerRegistered = false;\nexport const registerHandlers = () => {\n  if (handlerRegistered) {\n    return;\n  }\n  puppeteer.registerCustomQueryHandler('pierceShadowText', {\n    queryOne: querySelectorShadowTextOne,\n    queryAll: querySelectorShadowTextAll,\n  });\n  handlerRegistered = true;\n};\n"]}