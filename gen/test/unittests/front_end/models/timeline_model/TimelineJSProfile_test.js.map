{"version":3,"file":"TimelineJSProfile_test.js","sourceRoot":"","sources":["../../../../../../../../test/unittests/front_end/models/timeline_model/TimelineJSProfile_test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2020 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nconst {assert} = chai;\n\nimport * as SDK from '../../../../../front_end/core/sdk/sdk.js';\n\nimport * as TimelineModel from '../../../../../front_end/models/timeline_model/timeline_model.js';\n\ndescribe('TimelineJSProfile', () => {\n  let tracingModel: SDK.TracingModel.TracingModel;\n  let process: SDK.TracingModel.Process;\n  let thread: SDK.TracingModel.Thread;\n\n  const config = {\n    showAllEvents: false,\n    showRuntimeCallStats: false,\n    showNativeFunctions: false,\n  };\n\n  before(() => {\n    tracingModel = new SDK.TracingModel.TracingModel(new FakeStorage());\n    process = new SDK.TracingModel.Process(tracingModel, 1);\n    thread = new SDK.TracingModel.Thread(process, 1);\n  });\n\n  it('generateJSFrameEvents returns an empty array for an empty input', () => {\n    const events: SDK.TracingModel.Event[] = [];\n    const returnedEvents =\n        TimelineModel.TimelineJSProfile.TimelineJSProfileProcessor.generateJSFrameEvents(events, config);\n    assert.deepEqual(returnedEvents, []);\n  });\n\n  it('generateJSFrameEvents creates JS frame events with a top-level V8 invocation', () => {\n    const callEvent =\n        new SDK.TracingModel.Event('devtools.timeline', 'FunctionCall', SDK.TracingModel.Phase.Complete, 10, thread);\n    callEvent.setEndTime(20);\n    const sampleEvent =\n        new SDK.TracingModel.Event('devtools.timeline', 'JSSample', SDK.TracingModel.Phase.Instant, 5, thread);\n    sampleEvent.addArgs({data: {stackTrace: [{callFrame: {}}]}});\n    const events = [callEvent, sampleEvent];\n\n    const returnedEvents =\n        TimelineModel.TimelineJSProfile.TimelineJSProfileProcessor.generateJSFrameEvents(events, config);\n    assert.strictEqual(returnedEvents.length, 1);\n    assert.strictEqual(returnedEvents[0].name, 'JSFrame');\n    assert.strictEqual(returnedEvents[0].startTime, 5);\n    assert.strictEqual(returnedEvents[0].endTime, 20);\n  });\n\n  it('generateJSFrameEvents creates JS frame events without a top-level V8 invocation', () => {\n    const sampleEvent =\n        new SDK.TracingModel.Event('devtools.timeline', 'JSSample', SDK.TracingModel.Phase.Instant, 5, thread);\n    sampleEvent.addArgs({data: {stackTrace: [{callFrame: {}}]}});\n    const events = [sampleEvent];\n\n    const returnedEvents =\n        TimelineModel.TimelineJSProfile.TimelineJSProfileProcessor.generateJSFrameEvents(events, config);\n    assert.strictEqual(returnedEvents.length, 1);\n    assert.strictEqual(returnedEvents[0].name, 'JSFrame');\n    assert.strictEqual(returnedEvents[0].startTime, 5);\n    assert.strictEqual(returnedEvents[0].endTime, 5);\n  });\n\n  it('generateJSFrameEvents creates JS frame events for mixed with/without top-level events', () => {\n    const sampleEvent1 =\n        new SDK.TracingModel.Event('devtools.timeline', 'JSSample', SDK.TracingModel.Phase.Instant, 5, thread);\n    sampleEvent1.addArgs({data: {stackTrace: [{'functionName': 'a', 'callUID': 'a', 'scriptId': 1}]}});\n    const sampleEvent2 =\n        new SDK.TracingModel.Event('devtools.timeline', 'JSSample', SDK.TracingModel.Phase.Instant, 6, thread);\n    sampleEvent2.addArgs({data: {stackTrace: [{'functionName': 'a', 'callUID': 'a', 'scriptId': 1}]}});\n    const sampleEvent3 =\n        new SDK.TracingModel.Event('devtools.timeline', 'JSSample', SDK.TracingModel.Phase.Instant, 7, thread);\n    sampleEvent3.addArgs({data: {stackTrace: [{'functionName': 'a', 'callUID': 'a', 'scriptId': 1}]}});\n    const callEvent =\n        new SDK.TracingModel.Event('devtools.timeline', 'FunctionCall', SDK.TracingModel.Phase.Complete, 8, thread);\n    callEvent.setEndTime(15);\n    const sampleEvent4 =\n        new SDK.TracingModel.Event('devtools.timeline', 'JSSample', SDK.TracingModel.Phase.Instant, 9, thread);\n    sampleEvent4.addArgs({data: {stackTrace: [{'functionName': 'a', 'callUID': 'a', 'scriptId': 1}]}});\n    const sampleEvent5 =\n        new SDK.TracingModel.Event('devtools.timeline', 'JSSample', SDK.TracingModel.Phase.Instant, 10, thread);\n    sampleEvent5.addArgs({data: {stackTrace: [{'functionName': 'a', 'callUID': 'a', 'scriptId': 1}]}});\n    const events = [sampleEvent1, sampleEvent2, sampleEvent3, callEvent, sampleEvent4, sampleEvent5];\n\n    const returnedEvents =\n        TimelineModel.TimelineJSProfile.TimelineJSProfileProcessor.generateJSFrameEvents(events, config);\n    assert.strictEqual(returnedEvents.length, 2);\n    assert.strictEqual(returnedEvents[0].name, 'JSFrame');\n    assert.strictEqual(returnedEvents[0].startTime, 5);\n    assert.strictEqual(returnedEvents[0].endTime, 8);\n    assert.strictEqual(returnedEvents[1].name, 'JSFrame');\n    assert.strictEqual(returnedEvents[1].startTime, 9);\n    assert.strictEqual(returnedEvents[1].endTime, 15);\n  });\n});\n\nclass FakeStorage extends SDK.TracingModel.BackingStorage {\n  appendString() {\n    throw new Error('Not implemented yet');\n  }\n\n  appendAccessibleString(): () => Promise<string|null> {\n    throw new Error('Not implemented yet');\n  }\n\n  finishWriting() {\n    throw new Error('Not implemented yet');\n  }\n\n  reset() {\n    throw new Error('Not implemented yet');\n  }\n}\n"]}