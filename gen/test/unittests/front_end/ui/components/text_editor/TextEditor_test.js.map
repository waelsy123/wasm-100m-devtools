{"version":3,"file":"TextEditor_test.js","sourceRoot":"","sources":["../../../../../../../../../test/unittests/front_end/ui/components/text_editor/TextEditor_test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2020 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../../../../../front_end/core/common/common.js';\nimport * as CodeMirror from '../../../../../../front_end/third_party/codemirror.next/codemirror.next.js';\nimport * as TextEditor from '../../../../../../front_end/ui/components/text_editor/text_editor.js';\nimport {renderElementIntoDOM} from '../../../helpers/DOMHelpers.js';\nimport {describeWithEnvironment} from '../../../helpers/EnvironmentHelpers.js';\n\nconst {assert} = chai;\n\nfunction makeState(doc: string, extensions: CodeMirror.Extension = []) {\n  return CodeMirror.EditorState.create({\n    doc,\n    extensions: [\n      extensions,\n      TextEditor.Config.baseConfiguration(doc),\n      TextEditor.Config.autocompletion,\n    ],\n  });\n}\n\ndescribeWithEnvironment('TextEditor', () => {\n  describe('component', () => {\n    it('has a state property', () => {\n      const editor = new TextEditor.TextEditor.TextEditor(makeState('one'));\n      assert.strictEqual(editor.state.doc.toString(), 'one');\n      editor.state = makeState('two');\n      assert.strictEqual(editor.state.doc.toString(), 'two');\n      renderElementIntoDOM(editor);\n      assert.strictEqual(editor.editor.state.doc.toString(), 'two');\n      editor.editor.dispatch({changes: {from: 3, insert: '!'}});\n      editor.remove();\n      assert.strictEqual(editor.editor.state.doc.toString(), 'two!');\n    });\n\n    it('sets an aria-label attribute', () => {\n      const editor = new TextEditor.TextEditor.TextEditor(makeState(''));\n      assert.strictEqual(editor.editor.contentDOM.getAttribute('aria-label'), 'Code editor');\n    });\n\n    it('can highlight whitespace', () => {\n      const editor = new TextEditor.TextEditor.TextEditor(\n          makeState('line1  \\n  line2( )\\n\\tline3  ', TextEditor.Config.showWhitespace.instance()));\n      renderElementIntoDOM(editor);\n      assert.strictEqual(editor.editor.dom.querySelectorAll('.cm-trailingWhitespace, .cm-highlightedSpaces').length, 0);\n      Common.Settings.Settings.instance().moduleSetting('showWhitespacesInEditor').set('all');\n      assert.strictEqual(editor.editor.dom.querySelectorAll('.cm-highlightedSpaces').length, 4);\n      assert.strictEqual(editor.editor.dom.querySelectorAll('.cm-highlightedTab').length, 1);\n      Common.Settings.Settings.instance().moduleSetting('showWhitespacesInEditor').set('trailing');\n      assert.strictEqual(editor.editor.dom.querySelectorAll('.cm-highlightedSpaces').length, 0);\n      assert.strictEqual(editor.editor.dom.querySelectorAll('.cm-trailingWhitespace').length, 2);\n      Common.Settings.Settings.instance().moduleSetting('showWhitespacesInEditor').set('none');\n      assert.strictEqual(editor.editor.dom.querySelectorAll('.cm-trailingWhitespace, .cm-highlightedSpaces').length, 0);\n      editor.remove();\n    });\n  });\n\n  describe('configuration', () => {\n    it('can guess indentation', () => {\n      assert.strictEqual(\n          TextEditor.Config.guessIndent(CodeMirror.Text.of(['hello():', '    world();', '    return;'])), '    ');\n      assert.strictEqual(\n          TextEditor.Config.guessIndent(CodeMirror.Text.of(['hello():', '\\tworld();', '\\treturn;'])), '\\t');\n    });\n\n    it('can detect line separators', () => {\n      assert.strictEqual(makeState('one\\r\\ntwo\\r\\nthree').lineBreak, '\\r\\n');\n      assert.strictEqual(makeState('one\\ntwo\\nthree').lineBreak, '\\n');\n      assert.strictEqual(makeState('one\\r\\ntwo\\nthree').lineBreak, '\\n');\n    });\n\n    it('handles dynamic reconfiguration', () => {\n      const editor = new TextEditor.TextEditor.TextEditor(makeState(''));\n      renderElementIntoDOM(editor);\n\n      assert.strictEqual(editor.state.facet(CodeMirror.indentUnit), '    ');\n      Common.Settings.Settings.instance().moduleSetting('textEditorIndent').set('\\t');\n      assert.strictEqual(editor.state.facet(CodeMirror.indentUnit), '\\t');\n      Common.Settings.Settings.instance().moduleSetting('textEditorIndent').set('    ');\n    });\n  });\n\n  describe('autocompletion', () => {\n    it('can complete builtins and keywords', async () => {\n      const state = makeState('c', CodeMirror.javascript.javascriptLanguage);\n      const result =\n          await TextEditor.JavaScript.javascriptCompletionSource(new CodeMirror.CompletionContext(state, 1, false));\n      assert.isNotNull(result);\n      const completions = result ? result.options : [];\n      assert.isTrue(completions.some(o => o.label === 'clear'));\n      assert.isTrue(completions.some(o => o.label === 'continue'));\n    });\n\n    async function testQueryType(\n        code: string,\n        pos: number,\n        type?: TextEditor.JavaScript.QueryType,\n        range: string = '',\n        related?: string,\n        ): Promise<void> {\n      const state = makeState(code, CodeMirror.javascript.javascriptLanguage);\n      const query = TextEditor.JavaScript.getQueryType(CodeMirror.syntaxTree(state), pos, state.doc);\n      if (type === undefined) {\n        assert.isNull(query);\n      } else {\n        assert.isNotNull(query);\n        if (query) {\n          assert.strictEqual(query.type, type);\n          assert.strictEqual(code.slice(query.from ?? pos, pos), range);\n          assert.strictEqual(query.relatedNode && code.slice(query.relatedNode.from, query.relatedNode.to), related);\n        }\n      }\n    }\n\n    it('recognizes expression queries', async () => {\n      await testQueryType('foo', 3, TextEditor.JavaScript.QueryType.Expression, 'foo');\n      await testQueryType('foo ', 4, TextEditor.JavaScript.QueryType.Expression, '');\n      await testQueryType('let', 3, TextEditor.JavaScript.QueryType.Expression, 'let');\n    });\n\n    it('recognizes propery name queries', async () => {\n      await testQueryType('foo.bar', 7, TextEditor.JavaScript.QueryType.PropertyName, 'bar', 'foo.bar');\n      await testQueryType('foo.', 4, TextEditor.JavaScript.QueryType.PropertyName, '', 'foo.');\n      await testQueryType('if (foo.', 8, TextEditor.JavaScript.QueryType.PropertyName, '', 'foo.');\n      await testQueryType('foo.', 4, TextEditor.JavaScript.QueryType.PropertyName, '', 'foo.');\n      await testQueryType('foo.\\n', 5, TextEditor.JavaScript.QueryType.PropertyName, '', 'foo.');\n      await testQueryType('new foo.bar().', 14, TextEditor.JavaScript.QueryType.PropertyName, '', 'new foo.bar().');\n      await testQueryType('foo?.', 5, TextEditor.JavaScript.QueryType.PropertyName, '', 'foo?.');\n      await testQueryType('foo?.b', 6, TextEditor.JavaScript.QueryType.PropertyName, 'b', 'foo?.b');\n    });\n\n    it('recognizes property expression queries', async () => {\n      await testQueryType('foo[', 4, TextEditor.JavaScript.QueryType.PropertyExpression, '', 'foo[');\n      await testQueryType('foo[ ', 5, TextEditor.JavaScript.QueryType.PropertyExpression, '', 'foo[');\n      await testQueryType('foo[\"ba', 7, TextEditor.JavaScript.QueryType.PropertyExpression, '\"ba', 'foo[\"ba');\n    });\n\n    describe('potential map key retrievals', () => {\n      it('recognizes potential maps', async () => {\n        await testQueryType('foo.get(', 8, TextEditor.JavaScript.QueryType.PotentiallyRetrievingFromMap, '', 'foo');\n        await testQueryType('foo\\n.get(', 9, TextEditor.JavaScript.QueryType.PotentiallyRetrievingFromMap, '', 'foo');\n      });\n\n      it('leaves other expressions as-is', async () => {\n        await testQueryType('foo.method(', 11, TextEditor.JavaScript.QueryType.Expression);\n        await testQueryType('5 + (', 5, TextEditor.JavaScript.QueryType.Expression);\n        await testQueryType('functionCall(', 13, TextEditor.JavaScript.QueryType.Expression);\n      });\n    });\n\n    it('does not complete in inappropriate places', async () => {\n      await testQueryType('\"foo bar\"', 4);\n      await testQueryType('x[\"foo\" + \"bar', 14);\n      await testQueryType('// comment', 10);\n    });\n  });\n});\n"]}