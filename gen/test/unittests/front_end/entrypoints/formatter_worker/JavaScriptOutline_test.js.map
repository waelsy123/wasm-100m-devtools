{"version":3,"file":"JavaScriptOutline_test.js","sourceRoot":"","sources":["../../../../../../../../test/unittests/front_end/entrypoints/formatter_worker/JavaScriptOutline_test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2021 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nconst {assert} = chai;\n\nimport * as FormatterWorker from '../../../../../front_end/entrypoints/formatter_worker/formatter_worker.js';\n\ntype Item = {\n  title: string,\n  subtitle?: string, line: number, column: number,\n};\n\nfunction javaScriptOutline(text: string): Promise<Item[]> {\n  return new Promise(resolve => {\n    const items: Item[] = [];\n    FormatterWorker.JavaScriptOutline.javaScriptOutline(text, ({chunk, isLastChunk}) => {\n      items.push(...chunk);\n      if (isLastChunk) {\n        resolve(items);\n      }\n    });\n  });\n}\n\ndescribe('JavaScriptOutline', () => {\n  it('handles empty scripts', async () => {\n    const items = await javaScriptOutline('');\n    assert.deepEqual(items, []);\n  });\n\n  it('handles simple function statements', async () => {\n    const items = await javaScriptOutline('function foo(a, b, c) {}');\n    assert.deepEqual(items, [\n      {title: 'foo', subtitle: '(a, b, c)', line: 0, column: 9},\n    ]);\n  });\n\n  it('handles function statements with rest arguments', async () => {\n    const items = await javaScriptOutline('function foo(a, b, ...c) {}');\n    assert.deepEqual(items, [\n      {title: 'foo', subtitle: '(a, b, ...c)', line: 0, column: 9},\n    ]);\n  });\n\n  it('handles function expressions in variable declarations', async () => {\n    const items = await javaScriptOutline('var a = function(a,b) { }, b = function bar(c,d) { }');\n    assert.deepEqual(items, [\n      {title: 'a', subtitle: '(a, b)', line: 0, column: 4},\n      {title: 'b', subtitle: '(c, d)', line: 0, column: 27},\n    ]);\n  });\n\n  it('handles function expressions in property assignments', async () => {\n    const items = await javaScriptOutline(`a.b.c = function(d, e) { };\na.b[c] = function() { };\na.b[c].d = function() { };\n(a || b).c = function() { };`);\n    assert.deepEqual(items, [\n      {title: 'c', subtitle: '(d, e)', line: 0, column: 0},\n      {title: 'd', subtitle: '()', line: 2, column: 0},\n      {title: 'c', subtitle: '()', line: 3, column: 0},\n    ]);\n  });\n\n  it('handles function expressions in object literals', async () => {\n    const items = await javaScriptOutline(`x = { run: function() { }, get count() { }, set count(value) { }};\nvar foo = { \"bar\": function() { }};\nvar foo = { 42: function() { }}`);\n    assert.deepEqual(items, [\n      {title: 'run', subtitle: '()', line: 0, column: 6},\n      {title: 'get count', subtitle: '()', line: 0, column: 31},\n      {title: 'set count', subtitle: '(value)', line: 0, column: 48},\n    ]);\n  });\n\n  it('handles arrow functions in variable declarations', async () => {\n    const items = await javaScriptOutline(`var a = x => x + 2;\nvar b = (x, y) => x + y`);\n    assert.deepEqual(items, [\n      {title: 'a', subtitle: '(x)', line: 0, column: 4},\n      {title: 'b', subtitle: '(x, y)', line: 1, column: 4},\n    ]);\n  });\n\n  it('handles nested function statements', async () => {\n    const items = await javaScriptOutline('function foo(){ function bar() {} function baz() { }}');\n    assert.deepEqual(items, [\n      {title: 'foo', subtitle: '()', line: 0, column: 9},\n      {title: 'bar', subtitle: '()', line: 0, column: 25},\n      {title: 'baz', subtitle: '()', line: 0, column: 43},\n    ]);\n  });\n\n  it('handles class constructors', async () => {\n    const items = await javaScriptOutline('class Test { constructor(foo, bar) { }}');\n    assert.deepEqual(items, [\n      {title: 'class Test', subtitle: undefined, line: 0, column: 6},\n      {title: 'constructor', subtitle: '(foo, bar)', line: 0, column: 13},\n    ]);\n  });\n\n  it('handles class methods', async () => {\n    const items = await javaScriptOutline('class Test { foo() {} static bar() { }}');\n    assert.deepEqual(items, [\n      {title: 'class Test', subtitle: undefined, line: 0, column: 6},\n      {title: 'foo', subtitle: '()', line: 0, column: 13},\n      {title: 'static bar', subtitle: '()', line: 0, column: 29},\n    ]);\n  });\n\n  it('handles anonymous classes', async () => {\n    const items = await javaScriptOutline(`var test = class { constructor() { }};\nvar A = class extends B { foo() { }}`);\n    assert.deepEqual(items, [\n      {title: 'class test', subtitle: undefined, line: 0, column: 4},\n      {title: 'constructor', subtitle: '()', line: 0, column: 19},\n      {title: 'class A', subtitle: undefined, line: 1, column: 4},\n      {title: 'foo', subtitle: '()', line: 1, column: 26},\n    ]);\n  });\n\n  it('handles object literals with class properties', async () => {\n    const items = await javaScriptOutline(`var foo = { 42: class { }};\nvar foo = { \"foo\": class { }};\nvar foo = { foo: class { }};`);\n    assert.deepEqual(items, [\n      {title: 'class foo', subtitle: undefined, line: 2, column: 12},\n    ]);\n  });\n\n  it('handles async functions', async () => {\n    const items = await javaScriptOutline(`async function foo() { };\nvar sum = async (x, y) => x + y;`);\n    assert.deepEqual(items, [\n      {title: 'async foo', subtitle: '()', line: 0, column: 15},\n      {title: 'async sum', subtitle: '(x, y)', line: 1, column: 4},\n    ]);\n  });\n\n  it('handles generator functions', async () => {\n    const items = await javaScriptOutline('function* foo() { }');\n    assert.deepEqual(items, [\n      {title: '*foo', subtitle: '()', line: 0, column: 10},\n    ]);\n  });\n\n  it('recovers from syntax errors', async () => {\n    const items = await javaScriptOutline(`\nfunction foo(a, b) {\n    if (a > b) {\n        return a;\n}\n\nfunction bar(eee) {\n    yield foo(eee, 2 * eee);\n}\n`);\n    assert.deepEqual(items, [\n      {title: 'foo', subtitle: '(a, b)', line: 1, column: 9},\n      {title: 'bar', subtitle: '(eee)', line: 6, column: 9},\n    ]);\n  });\n});\n"]}