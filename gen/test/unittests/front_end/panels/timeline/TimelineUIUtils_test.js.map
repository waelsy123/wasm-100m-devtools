{"version":3,"file":"TimelineUIUtils_test.js","sourceRoot":"","sources":["../../../../../../../../test/unittests/front_end/panels/timeline/TimelineUIUtils_test.ts"],"names":[],"mappings":"AAAA,4DAA4D;AAC5D,yEAAyE;AACzE,6BAA6B;AAE7B,OAAO,KAAK,QAAQ,MAAM,sDAAsD,CAAC;AAGjF,MAAM,EAAC,MAAM,EAAC,GAAG,IAAI,CAAC;AAQtB,SAAS,mBAAmB,CAAC,UAAqC;IAChE,MAAM,eAAe,GAAG;QACtB,IAAI,EAAE;YACJ,IAAI,EAAE;gBACJ,gBAAgB,EAAE,UAAU,CAAC,cAAc;gBAC3C,oBAAoB,EAAE,UAAU,CAAC,kBAAkB;aACpD;SACF;QACD,SAAS,EAAE,UAAU,CAAC,SAAS;KACK,CAAC;IAEvC,OAAO,eAAe,CAAC;AACzB,CAAC;AAED,QAAQ,CAAC,+BAA+B,EAAE,GAAG,EAAE;IAC7C,EAAE,CAAC,4DAA4D,EAAE,GAAG,EAAE;QACpE,MAAM,kBAAkB,GAAG,mBAAmB,CAAC;YAC7C,cAAc,EAAE,IAAI;YACpB,kBAAkB,EAAE,IAAI;YACxB,SAAS,EAAE,IAAI;SAChB,CAAC,CAAC;QACH,MAAM,YAAY,GAA6B,CAAC,kBAAkB,CAAC,CAAC;QACpE,QAAQ,CAAC,eAAe,CAAC,4BAA4B,CAAC,YAAY,CAAC,CAAC;QACpE,MAAM,CAAC,WAAW,CAAC,kBAAkB,CAAC,IAAI,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;IACvE,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,kEAAkE,EAAE,GAAG,EAAE;QAC1E,MAAM,wBAAwB,GAAG,mBAAmB,CAAC;YACnD,cAAc,EAAE,KAAK;YACrB,kBAAkB,EAAE,SAAS;YAC7B,SAAS,EAAE,IAAI;SAChB,CAAC,CAAC;QACH,MAAM,YAAY,GAA6B,CAAC,wBAAwB,CAAC,CAAC;QAC1E,QAAQ,CAAC,eAAe,CAAC,4BAA4B,CAAC,YAAY,CAAC,CAAC;QACpE,MAAM,CAAC,WAAW,CAAC,wBAAwB,CAAC,IAAI,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;IAC7E,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,4DAA4D,EAAE,GAAG,EAAE;QACpE,MAAM,QAAQ,GAAG,mBAAmB,CAAC;YACnC,cAAc,EAAE,KAAK;YACrB,kBAAkB,EAAE,IAAI;YACxB,SAAS,EAAE,IAAI;SAChB,CAAC,CAAC;QAEH,MAAM,QAAQ,GAAG,mBAAmB,CAAC;YACnC,cAAc,EAAE,KAAK;YACrB,kBAAkB,EAAE,IAAI;YACxB,SAAS,EAAE,QAAQ,CAAC,SAAS,GAAG,GAAG;SACpC,CAAC,CAAC;QACH,MAAM,YAAY,GAA6B,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;QACpE,QAAQ,CAAC,eAAe,CAAC,4BAA4B,CAAC,YAAY,CAAC,CAAC;QAEpE,MAAM,CAAC,WAAW,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,mBAAmB,EAAE,CAAC,CAAC,CAAC;QAC9D,MAAM,CAAC,WAAW,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,mBAAmB,EAAE,CAAC,CAAC,CAAC;QAC9D,MAAM,CAAC,WAAW,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,sBAAsB,EAAE,IAAI,CAAC,CAAC;QACpE,MAAM,CAAC,WAAW,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,sBAAsB,EAAE,IAAI,CAAC,CAAC;IACtE,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,gDAAgD,EAAE,GAAG,EAAE;QACxD,MAAM,QAAQ,GAAG,mBAAmB,CAAC;YACnC,cAAc,EAAE,KAAK;YACrB,kBAAkB,EAAE,IAAI;YACxB,SAAS,EAAE,IAAI;SAChB,CAAC,CAAC;QAEH,MAAM,QAAQ,GAAG,mBAAmB,CAAC;YACnC,cAAc,EAAE,KAAK;YACrB,kBAAkB,EAAE,IAAI;YACxB,SAAS,EAAE,QAAQ,CAAC,SAAS,GAAG,GAAG;SACpC,CAAC,CAAC;QAEH,MAAM,UAAU,GAAG,mBAAmB,CAAC;YACrC,cAAc,EAAE,KAAK;YACrB,kBAAkB,EAAE,IAAI;YACxB,SAAS,EAAE,KAAK;SACjB,CAAC,CAAC;QAEH,MAAM,YAAY,GAA6B,CAAC,QAAQ,EAAE,QAAQ,EAAE,UAAU,CAAC,CAAC;QAChF,QAAQ,CAAC,eAAe,CAAC,4BAA4B,CAAC,YAAY,CAAC,CAAC;QAEpE,MAAM,CAAC,WAAW,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,mBAAmB,EAAE,CAAC,CAAC,CAAC;QAC9D,MAAM,CAAC,WAAW,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,mBAAmB,EAAE,CAAC,CAAC,CAAC;QAC9D,MAAM,CAAC,WAAW,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,sBAAsB,EAAE,IAAI,CAAC,CAAC;QACpE,MAAM,CAAC,WAAW,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,sBAAsB,EAAE,IAAI,CAAC,CAAC;QAEpE,MAAM,CAAC,WAAW,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,mBAAmB,EAAE,CAAC,CAAC,CAAC;QAChE,MAAM,CAAC,WAAW,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,sBAAsB,EAAE,IAAI,CAAC,CAAC;IACxE,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","sourcesContent":["// Copyright 2021 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Timeline from '../../../../../front_end/panels/timeline/timeline.js';\nimport type * as SDK from '../../../../../front_end/core/sdk/sdk.js';\n\nconst {assert} = chai;\n\ninterface FakeLayoutShiftProperties {\n  startTime: number;\n  hadRecentInput: boolean;\n  weightedScoreDelta?: number;\n}\n\nfunction makeFakeLayoutShift(properties: FakeLayoutShiftProperties): SDK.TracingModel.Event {\n  const fakeLayoutShift = {\n    args: {\n      data: {\n        had_recent_input: properties.hadRecentInput,\n        weighted_score_delta: properties.weightedScoreDelta,\n      },\n    },\n    startTime: properties.startTime,\n  } as unknown as SDK.TracingModel.Event;\n\n  return fakeLayoutShift;\n}\n\ndescribe('groupLayoutShiftsIntoClusters', () => {\n  it('does not include layout shifts that have recent user input', () => {\n    const shiftWithUserInput = makeFakeLayoutShift({\n      hadRecentInput: true,\n      weightedScoreDelta: 0.01,\n      startTime: 2000,\n    });\n    const layoutShifts: SDK.TracingModel.Event[] = [shiftWithUserInput];\n    Timeline.TimelineUIUtils.assignLayoutShiftsToClusters(layoutShifts);\n    assert.isUndefined(shiftWithUserInput.args.data._current_cluster_id);\n  });\n\n  it('does not include layout shifts that have no weighted_score_delta', () => {\n    const shiftWithNoWeightedScore = makeFakeLayoutShift({\n      hadRecentInput: false,\n      weightedScoreDelta: undefined,\n      startTime: 2000,\n    });\n    const layoutShifts: SDK.TracingModel.Event[] = [shiftWithNoWeightedScore];\n    Timeline.TimelineUIUtils.assignLayoutShiftsToClusters(layoutShifts);\n    assert.isUndefined(shiftWithNoWeightedScore.args.data._current_cluster_id);\n  });\n\n  it('correctly combines events that are within the same session', () => {\n    const shiftOne = makeFakeLayoutShift({\n      hadRecentInput: false,\n      weightedScoreDelta: 0.01,\n      startTime: 2000,\n    });\n\n    const shiftTwo = makeFakeLayoutShift({\n      hadRecentInput: false,\n      weightedScoreDelta: 0.02,\n      startTime: shiftOne.startTime + 100,\n    });\n    const layoutShifts: SDK.TracingModel.Event[] = [shiftOne, shiftTwo];\n    Timeline.TimelineUIUtils.assignLayoutShiftsToClusters(layoutShifts);\n\n    assert.strictEqual(shiftOne.args.data._current_cluster_id, 1);\n    assert.strictEqual(shiftTwo.args.data._current_cluster_id, 1);\n    assert.strictEqual(shiftOne.args.data._current_cluster_score, 0.03);\n    assert.strictEqual(shiftTwo.args.data._current_cluster_score, 0.03);\n  });\n\n  it('correctly splits events into multiple clusters', () => {\n    const shiftOne = makeFakeLayoutShift({\n      hadRecentInput: false,\n      weightedScoreDelta: 0.01,\n      startTime: 2000,\n    });\n\n    const shiftTwo = makeFakeLayoutShift({\n      hadRecentInput: false,\n      weightedScoreDelta: 0.02,\n      startTime: shiftOne.startTime + 100,\n    });\n\n    const shiftThree = makeFakeLayoutShift({\n      hadRecentInput: false,\n      weightedScoreDelta: 0.05,\n      startTime: 10000,\n    });\n\n    const layoutShifts: SDK.TracingModel.Event[] = [shiftOne, shiftTwo, shiftThree];\n    Timeline.TimelineUIUtils.assignLayoutShiftsToClusters(layoutShifts);\n\n    assert.strictEqual(shiftOne.args.data._current_cluster_id, 1);\n    assert.strictEqual(shiftTwo.args.data._current_cluster_id, 1);\n    assert.strictEqual(shiftOne.args.data._current_cluster_score, 0.03);\n    assert.strictEqual(shiftTwo.args.data._current_cluster_score, 0.03);\n\n    assert.strictEqual(shiftThree.args.data._current_cluster_id, 2);\n    assert.strictEqual(shiftThree.args.data._current_cluster_score, 0.05);\n  });\n});\n"]}