{"version":3,"file":"InterestGroupStorageView_test.js","sourceRoot":"","sources":["../../../../../../../../test/unittests/front_end/panels/application/InterestGroupStorageView_test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2022 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nconst {assert} = chai;\n\nimport * as Resources from '../../../../../front_end/panels/application/application.js';\nimport * as Protocol from '../../../../../front_end/generated/protocol.js';\nimport {describeWithMockConnection} from '../../helpers/MockConnection.js';\nimport * as DataGrid from '../../../../../front_end/ui/components/data_grid/data_grid.js';\nimport {raf} from '../../helpers/DOMHelpers.js';\n\nimport View = Resources.InterestGroupStorageView;\n\nconst events = [\n  {\n    accessTime: 0,\n    type: Protocol.Storage.InterestGroupAccessType.Bid,\n    ownerOrigin: 'https://owner1.com',\n    name: 'cars',\n  },\n  {\n    accessTime: 10,\n    type: Protocol.Storage.InterestGroupAccessType.Join,\n    ownerOrigin: 'https://owner2.com',\n    name: 'trucks',\n  },\n];\n\nclass InterestGroupDetailsGetter {\n  async getInterestGroupDetails(owner: string, name: string): Promise<Protocol.Storage.InterestGroupDetails|null> {\n    return {\n      ownerOrigin: owner,\n      name: name,\n      expirationTime: 2,\n      joiningOrigin: 'https://joiner.com',\n      trustedBiddingSignalsKeys: [],\n      ads: [],\n      adComponents: [],\n    };\n  }\n}\n\nclass InterestGroupDetailsGetterFails {\n  async getInterestGroupDetails(_owner: string, _name: string): Promise<Protocol.Storage.InterestGroupDetails|null> {\n    return null;\n  }\n}\n\ndescribeWithMockConnection('InterestGroupStorageView', () => {\n  it('records events', () => {\n    const view = new View.InterestGroupStorageView(new InterestGroupDetailsGetter());\n    events.forEach(event => {\n      view.addEvent(event);\n    });\n    assert.deepEqual(view.getEventsForTesting(), events);\n  });\n\n  it('ignores duplicates', () => {\n    const view = new View.InterestGroupStorageView(new InterestGroupDetailsGetter());\n    events.forEach(event => {\n      view.addEvent(event);\n    });\n    view.addEvent(events[0]);\n    assert.deepEqual(view.getEventsForTesting(), events);\n  });\n\n  it('initially has placeholder sidebar', () => {\n    const view = new View.InterestGroupStorageView(new InterestGroupDetailsGetter());\n    assert.notDeepEqual(view.sidebarWidget()?.constructor.name, 'SearchableView');\n    assert.isTrue(view.sidebarWidget()?.contentElement.firstChild?.textContent?.includes('Click'));\n  });\n\n  it('updates sidebarWidget upon receiving cellFocusedEvent when InterestGroupGetter succeeds', async () => {\n    const view = new View.InterestGroupStorageView(new InterestGroupDetailsGetter());\n    events.forEach(event => {\n      view.addEvent(event);\n    });\n    const grid = view.getInterestGroupGridForTesting();\n    const cells = [\n      {columnId: 'event-time', value: 0},\n      {columnId: 'event-type', value: Protocol.Storage.InterestGroupAccessType.Join},\n      {columnId: 'event-group-owner', value: 'https://owner1.com'},\n      {columnId: 'event-group-name', value: 'cars'},\n    ];\n    const spy = sinon.spy(view, 'setSidebarWidget');\n    assert.isTrue(spy.notCalled);\n    grid.dispatchEvent(new DataGrid.DataGridEvents.BodyCellFocusedEvent({columnId: 'event-time', value: '0'}, {cells}));\n    await raf();\n    assert.isTrue(spy.calledOnce);\n    assert.deepEqual(view.sidebarWidget()?.constructor.name, 'SearchableView');\n  });\n\n  it('updates sidebarWidget upon receiving cellFocusedEvent when InterestGroupDetailsGetter fails', async () => {\n    const view = new View.InterestGroupStorageView(new InterestGroupDetailsGetterFails());\n    events.forEach(event => {\n      view.addEvent(event);\n    });\n    const grid = view.getInterestGroupGridForTesting();\n    const cells = [\n      {columnId: 'event-time', value: 0},\n      {columnId: 'event-type', value: Protocol.Storage.InterestGroupAccessType.Join},\n      {columnId: 'event-group-owner', value: 'https://owner1.com'},\n      {columnId: 'event-group-name', value: 'cars'},\n    ];\n    const spy = sinon.spy(view, 'setSidebarWidget');\n    assert.isTrue(spy.notCalled);\n    grid.dispatchEvent(new DataGrid.DataGridEvents.BodyCellFocusedEvent({columnId: 'event-time', value: '0'}, {cells}));\n    await raf();\n    assert.isTrue(spy.calledOnce);\n    assert.notDeepEqual(view.sidebarWidget()?.constructor.name, 'SearchableView');\n    assert.isTrue(view.sidebarWidget()?.contentElement.firstChild?.textContent?.includes('No details'));\n  });\n\n  it('clears sidebarWidget upon clearEvents', async () => {\n    const view = new View.InterestGroupStorageView(new InterestGroupDetailsGetter());\n    events.forEach(event => {\n      view.addEvent(event);\n    });\n    const grid = view.getInterestGroupGridForTesting();\n    const cells = [\n      {columnId: 'event-time', value: 0},\n      {columnId: 'event-type', value: Protocol.Storage.InterestGroupAccessType.Join},\n      {columnId: 'event-group-owner', value: 'https://owner1.com'},\n      {columnId: 'event-group-name', value: 'cars'},\n    ];\n    const spy = sinon.spy(view, 'setSidebarWidget');\n    assert.isTrue(spy.notCalled);\n    grid.dispatchEvent(new DataGrid.DataGridEvents.BodyCellFocusedEvent({columnId: 'event-time', value: '0'}, {cells}));\n    await raf();\n    assert.isTrue(spy.calledOnce);\n    assert.deepEqual(view.sidebarWidget()?.constructor.name, 'SearchableView');\n    view.clearEvents();\n    assert.isTrue(spy.calledTwice);\n    assert.notDeepEqual(view.sidebarWidget()?.constructor.name, 'SearchableView');\n    assert.isTrue(view.sidebarWidget()?.contentElement.firstChild?.textContent?.includes('Click'));\n  });\n});\n"]}