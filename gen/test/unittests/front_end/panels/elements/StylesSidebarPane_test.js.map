{"version":3,"file":"StylesSidebarPane_test.js","sourceRoot":"","sources":["../../../../../../../../test/unittests/front_end/panels/elements/StylesSidebarPane_test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2020 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as ElementsModule from '../../../../../front_end/panels/elements/elements.js';\nimport * as SDK from '../../../../../front_end/core/sdk/sdk.js';\nimport {createUISourceCode} from '../../helpers/UISourceCodeHelpers.js';\nimport {describeWithRealConnection} from '../../helpers/RealConnection.js';\nimport * as Workspace from '../../../../../front_end/models/workspace/workspace.js';\nimport {assertNotNullOrUndefined} from '../../../../../front_end/core/platform/platform.js';\nimport type * as Platform from '../../../../../front_end/core/platform/platform.js';\nimport type * as Protocol from '../../../../../front_end/generated/protocol.js';\nimport * as Bindings from '../../../../../front_end/models/bindings/bindings.js';\n\nconst {assert} = chai;\n\ndescribeWithRealConnection('StylesSidebarPane', async () => {\n  let Elements: typeof ElementsModule;\n  before(async () => {\n    Elements = await import('../../../../../front_end/panels/elements/elements.js');\n  });\n\n  it('unescapes CSS strings', () => {\n    assert.strictEqual(\n        Elements.StylesSidebarPane.unescapeCssString(\n            String.raw`\"I\\F1 t\\EB rn\\E2 ti\\F4 n\\E0 liz\\E6 ti\\F8 n\\2603 \\1F308  can be \\t\\r\\ic\\k\\y\"`),\n        '\"I\\xF1t\\xEBrn\\xE2ti\\xF4n\\xE0liz\\xE6ti\\xF8n\\u2603\\u{1F308} can be tricky\"');\n    assert.strictEqual(\n        Elements.StylesSidebarPane.unescapeCssString(String.raw`\"_\\DBFF_\\\\DBFF_\\\\\\DBFF_\\\\\\\\DBFF_\\\\\\\\\\DBFF_\"`),\n        '\"_\\uFFFD_\\\\DBFF_\\\\\\\\DBFF_\\\\\\\\\\\\DBFF_\\\\\\\\\\\\\\\\DBFF_\"');\n    assert.strictEqual(\n        Elements.StylesSidebarPane.unescapeCssString(String.raw`\"\\0_\\DBFF_\\DFFF_\\110000\"`),\n        '\"\\uFFFD_\\uFFFD_\\uFFFD_\\uFFFD\"', 'U+0000, lone surrogates, and values above U+10FFFF should become U+FFFD');\n    assert.strictEqual(\n        Elements.StylesSidebarPane.unescapeCssString(String.raw`\"_\\D83C\\DF08_\"`), '\"_\\uFFFD\\uFFFD_\"',\n        'surrogates should not be combined');\n    assert.strictEqual(\n        Elements.StylesSidebarPane.unescapeCssString('\"_\\\\41\\n_\\\\41\\t_\\\\41\\x20_\"'), '\"_A_A_A_\"',\n        'certain trailing whitespace characters should be consumed as part of the escape sequence');\n  });\n\n  it('escapes URL as CSS comments', () => {\n    assert.strictEqual(Elements.StylesSidebarPane.escapeUrlAsCssComment('https://abc.com/'), 'https://abc.com/');\n    assert.strictEqual(Elements.StylesSidebarPane.escapeUrlAsCssComment('https://abc.com/*/'), 'https://abc.com/*/');\n    assert.strictEqual(\n        Elements.StylesSidebarPane.escapeUrlAsCssComment('https://abc.com/*/?q=*'), 'https://abc.com/*/?q=*');\n    assert.strictEqual(\n        Elements.StylesSidebarPane.escapeUrlAsCssComment('https://abc.com/*/?q=*/'), 'https://abc.com/*/?q=*%2F');\n    assert.strictEqual(\n        Elements.StylesSidebarPane.escapeUrlAsCssComment('https://abc.com/*/?q=*/#hash'),\n        'https://abc.com/*/?q=*%2F#hash');\n  });\n\n  it('tracks property changes with formatting', async () => {\n    const workspace = Workspace.Workspace.WorkspaceImpl.instance();\n    const URL = 'file:///tmp/example.html' as Platform.DevToolsPath.UrlString;\n    const {uiSourceCode, project} = createUISourceCode({\n      url: URL,\n      content: '.rule{display:none}',\n      mimeType: 'text/css',\n      projectType: Workspace.Workspace.projectTypes.FileSystem,\n    });\n\n    uiSourceCode.setWorkingCopy('.rule{display:block}');\n\n    const stylesSidebarPane = Elements.StylesSidebarPane.StylesSidebarPane.instance();\n    await stylesSidebarPane.trackURLForChanges(URL);\n    const targetManager = SDK.TargetManager.TargetManager.instance();\n    const target = targetManager.mainTarget();\n    assertNotNullOrUndefined(target);\n\n    const resourceURL = () => URL;\n    const cssModel = new SDK.CSSModel.CSSModel(target);\n    cssModel.styleSheetHeaderForId = () => ({\n      lineNumberInSource: (line: number) => line,\n      columnNumberInSource: (_line: number, column: number) => column,\n      cssModel: () => cssModel,\n      resourceURL,\n      isConstructedByNew: () => false,\n    } as unknown as SDK.CSSStyleSheetHeader.CSSStyleSheetHeader);\n\n    const cssWorksapceBinding = Bindings.CSSWorkspaceBinding.CSSWorkspaceBinding.instance();\n    cssWorksapceBinding.modelAdded(cssModel);\n    cssWorksapceBinding.addSourceMapping({\n      rawLocationToUILocation: (loc: SDK.CSSModel.CSSLocation) => new Workspace.UISourceCode.UILocation(\n          uiSourceCode as Workspace.UISourceCode.UISourceCode, loc.lineNumber, loc.columnNumber),\n      uiLocationToRawLocations: (_: Workspace.UISourceCode.UILocation): SDK.CSSModel.CSSLocation[] => [],\n    });\n\n    const cssProperty = {\n      ownerStyle: {\n        type: SDK.CSSStyleDeclaration.Type.Regular,\n        styleSheetId: 'STYLE_SHEET_ID' as Protocol.CSS.StyleSheetId,\n        cssModel: () => cssModel,\n        parentRule: {resourceURL},\n      },\n      nameRange: () => ({startLine: 0, startColumn: '.rule{'.length}),\n    } as unknown as SDK.CSSProperty.CSSProperty;\n\n    assert.isTrue(stylesSidebarPane.isPropertyChanged(cssProperty));\n\n    Bindings.CSSWorkspaceBinding.CSSWorkspaceBinding.instance().modelRemoved(cssModel);\n    workspace.removeProject(project);\n    await stylesSidebarPane.trackURLForChanges(URL);  // Clean up diff subscription\n  });\n});\n"]}