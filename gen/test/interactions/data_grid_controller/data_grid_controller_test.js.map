{"version":3,"file":"data_grid_controller_test.js","sourceRoot":"","sources":["../../../../../../test/interactions/data_grid_controller/data_grid_controller_test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2020 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport {assert} from 'chai';\n\nimport {assertSubMenuItemsText, assertTopLevelContextMenuItemsText, findSubMenuEntryItem, platformSpecificTextForSubMenuEntryItem} from '../../e2e/helpers/context-menu-helpers.js';\nimport {getDataGrid, getDataGridController, getInnerTextOfDataGridCells} from '../../e2e/helpers/datagrid-helpers.js';\nimport {$, $$, $textContent, click, waitFor, waitForFunction} from '../../shared/helper.js';\nimport {describe, it} from '../../shared/mocha-extensions.js';\nimport {loadComponentDocExample, preloadForCodeCoverage} from '../helpers/shared.js';\n\nasync function activateContextMenuOnColumnHeader(headerText: string) {\n  const dataGridController = await getDataGridController();\n  const dataGrid = await getDataGrid(dataGridController);\n  const headerCell = await $textContent(headerText, dataGrid);\n  if (!headerCell) {\n    assert.fail(`Could not find header cell with text ${headerText}`);\n  }\n  await click(headerCell, {\n    clickOptions: {\n      button: 'right',\n    },\n  });\n  return headerCell;\n}\n\nasync function activateContextMenuOnBodyCell(cellText: string) {\n  const dataGridController = await getDataGridController();\n  const dataGrid = await getDataGrid(dataGridController);\n  const headerCell = await $textContent(cellText, dataGrid);\n  if (!headerCell) {\n    assert.fail(`Could not find body cell with text ${cellText}`);\n  }\n  await click(headerCell, {\n    clickOptions: {\n      button: 'right',\n    },\n  });\n  return headerCell;\n}\n\nasync function waitForFirstBodyCellText(cellText: string) {\n  await waitForFunction(async () => {\n    const dataGrid = await getDataGrid();\n    const firstBodyCell = await $<HTMLTableCellElement>('tbody td', dataGrid);\n    const text = firstBodyCell && await firstBodyCell.evaluate(cell => cell.innerText);\n    return text === cellText;\n  });\n}\n\ndescribe('data grid controller', () => {\n  preloadForCodeCoverage('data_grid_controller/basic.html');\n\n  // Fails on Mac after theming change\n  it('lets the user right click on a header to show the context menu', async () => {\n    await loadComponentDocExample('data_grid_controller/basic.html');\n    await activateContextMenuOnColumnHeader('Key');\n\n    const contextMenu = await $('.soft-context-menu');\n    assert.isNotNull(contextMenu);\n    await assertTopLevelContextMenuItemsText(\n        ['Value', platformSpecificTextForSubMenuEntryItem('Sort By'), 'Reset Columns']);\n  });\n\n  it('lists the hideable columns in the context menu and lets the user click to toggle the visibility', async () => {\n    await loadComponentDocExample('data_grid_controller/basic.html');\n    await activateContextMenuOnColumnHeader('Key');\n    const contextMenu = await $('.soft-context-menu');\n    assert.isNotNull(contextMenu);\n    const valueColumnOption = await $('[aria-label=\"Value, checked\"]');\n    if (!valueColumnOption) {\n      assert.fail('Could not find Value column in context menu.');\n    }\n    await click(valueColumnOption);\n    const dataGrid = await getDataGrid();\n\n    await waitForFunction(async () => {\n      const hiddenCells = await $$('tbody td.hidden', dataGrid);\n      return hiddenCells.length === 3;\n    });\n\n    const renderedText = await getInnerTextOfDataGridCells(dataGrid, 3);\n    assert.deepEqual(\n        [\n          ['Bravo'],\n          ['Alpha'],\n          ['Charlie'],\n        ],\n        renderedText);\n  });\n\n  // Fails on Mac after theming change\n  it('lists sortable columns in a sub-menu and lets the user click to sort', async () => {\n    await loadComponentDocExample('data_grid_controller/basic.html');\n    await activateContextMenuOnColumnHeader('Key');\n    const contextMenu = await $('.soft-context-menu');\n    if (!contextMenu) {\n      assert.fail('Could not find context menu.');\n    }\n    const sortBy = await findSubMenuEntryItem('Sort By');\n    await sortBy.hover();\n\n    const keyColumnSort = await waitFor('[aria-label=\"Key\"]');\n    await keyColumnSort.click();\n    await waitForFirstBodyCellText('Alpha');\n\n    const dataGrid = await getDataGrid();\n    const renderedText = await getInnerTextOfDataGridCells(dataGrid, 3);\n    assert.deepEqual(\n        [\n          ['Alpha', 'Letter A'],\n          ['Bravo', 'Letter B'],\n          ['Charlie', 'Letter C'],\n        ],\n        renderedText);\n  });\n\n  it('lets the user click on a column header to sort it', async () => {\n    await loadComponentDocExample('data_grid_controller/basic.html');\n\n    const keyHeaderCell = await waitFor('th[data-grid-header-cell=\"key\"]');\n    await keyHeaderCell.click();\n    await waitForFirstBodyCellText('Alpha');\n\n    const dataGrid = await getDataGrid();\n    const renderedText = await getInnerTextOfDataGridCells(dataGrid, 3);\n    assert.deepEqual(\n        [\n          ['Alpha', 'Letter A'],\n          ['Bravo', 'Letter B'],\n          ['Charlie', 'Letter C'],\n        ],\n        renderedText);\n  });\n\n  // Fails on Mac after theming change\n  it('lists sort by and header options when right clicking on a body row', async () => {\n    await loadComponentDocExample('data_grid_controller/basic.html');\n    await activateContextMenuOnBodyCell('Bravo');\n\n    await assertTopLevelContextMenuItemsText([\n      platformSpecificTextForSubMenuEntryItem('Sort By'),\n      platformSpecificTextForSubMenuEntryItem('Header Options'),\n    ]);\n    await assertSubMenuItemsText('Header Options', ['Value', 'Reset Columns']);\n    await assertSubMenuItemsText('Sort By', ['Key', 'Value']);\n  });\n\n  // Fails on Mac after theming change\n  it('allows the parent to add custom context menu items', async () => {\n    await loadComponentDocExample('data_grid_controller/custom-context-menu-items.html');\n    await activateContextMenuOnBodyCell('Bravo');\n    await assertTopLevelContextMenuItemsText([\n      platformSpecificTextForSubMenuEntryItem('Sort By'),\n      platformSpecificTextForSubMenuEntryItem('Header Options'),\n      'Hello World',\n    ]);\n  });\n});\n"]}